<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GEMEL INVEST • מערכת CRM</title>
  <meta name="theme-color" content="#eef4ff" />

  <link rel="stylesheet" href="./app.css" />

  <style>
    /* Hotfix: move "new customer" button to the left side of the top bar (RTL-friendly) */
    .topbar{ position: relative; }
    .topbar__right{
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    #btnNewCustomer{ white-space: nowrap; }
    /* Show the new-customer button ONLY on dashboard */
    #btnNewCustomer{ display: inline-flex; }
    /* Hide the new-customer button outside dashboard once views are active */
    body.view-customers-active #btnNewCustomer,
    body.view-esign-active #btnNewCustomer,
    body.view-settings-active #btnNewCustomer,
    body.view-myflow-active #btnNewCustomer,
    body.view-users-active #btnNewCustomer{ display: none; }
    body.view-dashboard-active #btnNewCustomer{ display: inline-flex; }

    @media (max-width: 900px){
      .topbar__right{
        left: 10px;
        top: auto;
        bottom: 10px;
        transform: none;
      }
    }


    /* ===== Modal: New Customer — compact logo (stays during whole modal) ===== */
    #modalCustomer .modal__head{
      position: sticky;
      top: 0;
      z-index: 5;
    }
    #modalCustomer .lcModalHead{
      position: sticky; /* keep header visible while scrolling inside modal */
      top: 0;
    }
    #modalCustomer .lcModalHead__logo{
      position: absolute;
      inset-inline-end: 16px; /* LEFT side in RTL */
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      justify-content: flex-start;
      pointer-events: none;
    }
    #modalCustomer .lcModalHead__logo img{
      width: 160px;           /* קומפקטי (לא קטן מדי) */
      max-width: 180px;
      height: auto;
      max-height: 40px;
      object-fit: contain;
      filter: drop-shadow(0 8px 12px rgba(11,31,74,.18));
      opacity: .98;
    }
    /* keep titles from overlapping the logo on the left */
    #modalCustomer .lcModalHead__titles{
      padding-inline-end: 200px;
    }
    @media (max-width: 720px){
      #modalCustomer .lcModalHead__logo img{ width: 130px; max-width: 150px; max-height: 34px; }
      #modalCustomer .lcModalHead__titles{ padding-inline-end: 170px; }
    }

</style>
</head>

<body class="lcAuthLock">
  <!-- Login Overlay (Premium) -->
  <div class="lcLogin" id="lcLogin" aria-hidden="true">
    <div class="lcLogin__card" role="dialog" aria-modal="true" aria-label="כניסה למערכת">
      <div class="lcLogin__brand">
        <div class="lcLogin__logo lcLogin__logo--img" aria-hidden="true">
          <img src="./logo-login-clean.png" alt="GEMEL INVEST" class="lcLogin__logoImg" />
        </div>
        <div class="lcLogin__brandText">
          <div class="lcLogin__brandName">GEMEL INVEST</div>
          <div class="lcLogin__brandSub">סוכנות לביטוח</div>
        </div>
      </div>

      <div class="lcLogin__title">כניסה למערכת</div>
      <div class="lcLogin__hint">הזן שם משתמש וקוד כניסה</div>

      <form id="lcLoginForm" class="lcLogin__form" autocomplete="off">
        <label class="lcLogin__label">שם משתמש</label>
        <input id="lcLoginUser" name="username" class="lcLogin__input" placeholder="לדוגמה: מנהל מערכת / סתיו" />

        <label class="lcLogin__label">קוד כניסה (PIN)</label>
        <input id="lcLoginPin" name="pin" class="lcLogin__input" inputmode="numeric" placeholder="••••" />

        <label class="lcLogin__remember">
          <input id="lcLoginRemember" type="checkbox" />
          <span>זכור אותי במחשב הזה</span>
        </label>

        <button class="lcLogin__btn" type="submit">התחבר</button>
        <div id="lcLoginError" class="lcLogin__error" aria-live="polite"></div>
      </form>

      <div class="lcLogin__foot">שכחת קוד? פנה למנהל המערכת</div>
    </div>
  </div>

  <div class="app" id="app">
    <!-- Sidebar (left) -->
    <aside class="sidebar" aria-label="תפריט ראשי">
      <div class="brand brand--logoOnly">
        <div class="brand__logo brand__logo--img" aria-hidden="true">
          <img src="./logo-login-clean.png" alt="GEMEL INVEST" class="brand__logoImg" />
        </div>
      </div>

      <nav class="nav">
        <button class="nav__item is-active" data-view="dashboard">
          <span class="nav__icon">📊</span>
          <span class="nav__label">דשבורד</span>
        </button>

        <button class="nav__item" data-view="customers">
          <span class="nav__icon">👥</span>
          <span class="nav__label">לקוחות</span>
        </button><button class="nav__item" data-view="settings">
          <span class="nav__icon">⚙️</span>
          <span class="nav__label">הגדרות מערכת</span>
        </button>

        <button class="nav__item" data-view="users" id="navUsers" style="display:none">
          <span class="nav__icon">👥</span>
          <span class="nav__label">ניהול משתמשים</span>
        </button>
      </nav>

      <div class="sidebar__foot">
        <div class="pill">
          <span class="dot" id="syncDot" aria-hidden="true"></span>
          <span id="syncText">מצב: Google Sheets</span>
        </div>
        <div class="muted small" id="lastSyncText" aria-live="polite">לא סונכרן עדיין</div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <div class="topbar__left">
          <div class="pageTitle">
            <div class="pageTitle__kicker">GEMEL INVEST</div>
            <h1 class="pageTitle__title" id="pageTitle">דשבורד</h1>
          </div>
        </div>

        <div class="topbar__center only-customers">
          <div class="search">
            <input id="globalSearch" class="search__input" type="search" placeholder="חיפוש לקוח (שם / טלפון / ת״ז)..."  />
            <button class="search__btn" id="btnSearch" type="button" aria-label="חיפוש">חיפוש</button>
          </div>
        </div>

        <div class="topbar__right">
          <button class="btn btn--primary" id="btnNewCustomer">
            הקמת לקוח חדש במערכת
          </button>
          <div class="lcUserPill" id="lcUserPill" style="display:none;">
            <span class="lcUserPill__dot" aria-hidden="true"></span>
            <span class="lcUserPill__text" id="lcUserPillText">מחובר</span>
            <button class="lcUserPill__btn" id="btnLogout" type="button">התנתק</button>
          </div>

        </div>
      </header>

      <!-- Content -->
      <section class="content">

        <!-- DASHBOARD -->
        <section class="view is-visible" id="view-dashboard"></section>

        <!-- CUSTOMERS -->
        <section class="view" id="view-customers">
          <div class="card">
            <div class="card__head">
              <div class="card__title">רשימת לקוחות</div>
              <div class="card__hint">לחץ על לקוח כדי לפתוח תיק</div>
            </div>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>שם</th>
                    <th>טלפון</th>
                    <th>ת״ז</th>
                    <th>פרמיה חודשית</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="customersTbody">
                  <!-- injected -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- MY FLOW --><!-- ESIGN --><!-- SETTINGS -->
        <section class="view" id="view-settings">
          <div class="card">
            <div class="card__head">
              <div class="card__title">הגדרות מערכת</div>
              <div class="card__hint">חיבור ל-Google Sheets + מצב עבודה</div>
            </div>

            <div class="formGrid">
              <div class="field">
                <label class="label">מצב נתונים</label>
                <div class="pill" style="display:inline-flex; margin-top:6px">
                  <span class="dot ok" aria-hidden="true"></span>
                  <span>Google Sheets בלבד</span>
                </div>
                <div class="help">המערכת עובדת רק מול Google Sheets (Apps Script Web App). אין מצב Local בגירסה הזו.</div>
              </div>

              <div class="field">
                <label class="label">כתובת Web App (Apps Script)</label>
                <input class="input" id="gsUrl" type="url" placeholder="הדבק כאן את ה-URL של ה-Web App" />
                <div class="help">לדוגמא: https://script.google.com/macros/s/XXXX/exec</div>
              </div>

              <div class="field">
                <label class="label">פעולות</label>
                <div class="row">
                  <button class="btn" id="btnTestConn" type="button">בדיקת חיבור</button>
                  <button class="btn" id="btnSyncNow" type="button">סנכרון עכשיו</button>
                                  </div>
                <div class="help">שמירה/טעינה מתבצעת מול ה-Web App. אם יש בעיה, בדוק Deploy והרשאות.</div>
              </div>
            </div>
          </div>
        </section>

        <!-- USERS (Admin only) -->
        <section class="view" id="view-users">
          <div class="card">
            <div class="card__head">
              <div class="card__title">ניהול משתמשים</div>
              <div class="card__hint">הוספה/עריכה/השבתה של נציגים וסוכנים</div>
            </div>

            <div class="lcUsers__actions">
              <button class="btn" id="btnAddUser" type="button">➕ הוסף נציג/סוכן</button>
              <input class="input lcUsers__search" id="usersSearch" type="text" placeholder="חיפוש לפי שם…" />
              <select class="input lcUsers__filter" id="usersFilter">
                <option value="all">הכל</option>
                <option value="active">פעילים</option>
                <option value="disabled">מושבתים</option>
              </select>
            </div>

            <div class="tableWrap">
              <table class="table">
                <thead>
                  <tr>
                    <th>שם</th>
                    <th>תפקיד</th>
                    <th>סטטוס</th>
                    <th style="width:220px">פעולות</th>
                  </tr>
                </thead>
                <tbody id="usersTbody"></tbody>
              </table>
            </div>
          </div>
        </section>

      </section>
    </main>
  </div>

  <!-- MODAL: New Customer -->
  <div class="modal" id="modalCustomer" aria-hidden="true">
    <div class="modal__backdrop" data-close="1"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal__head lcModalHead">
        <div class="lcModalHead__logo" aria-hidden="true">
          <img src="./logo-login-clean.png" alt="GEMEL INVEST" />
        </div>
        <div class="lcModalHead__titles">
          <div class="modal__kicker">GEMEL INVEST</div>
          <div class="modal__title" id="modalTitle">הקמת לקוח חדש</div>
        </div>
        <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
      </div>

      <form class="modal__body" id="customerForm">
      <div class="lcFormTop">
        <div class="lcProgress" aria-label="התקדמות מילוי">
          <div class="lcProgress__track">
            <div class="lcProgress__bar" id="custProgressBar" style="width:0%"></div>
          </div>
          <div class="lcProgress__text" id="custProgressText">השלמה: 0%</div>
        </div>

        <div class="lcTabs" role="tablist" aria-label="שלבים בהקמת לקוח">
          <button type="button" class="lcTab is-active" data-step="1" role="tab" aria-selected="true">פרטים</button>
          <button type="button" class="lcTab" data-step="2" role="tab" aria-selected="false">יצירת קשר</button>
          <button type="button" class="lcTab" data-step="3" role="tab" aria-selected="false">פרופיל</button>
          <button type="button" class="lcTab" data-step="4" role="tab" aria-selected="false">פוליסות קיימות</button>
        </div>
      </div>

      <div class="lcFormScroll" id="custSteps">
        <section class="lcStep is-active" data-step="1" aria-label="פרטים">
        <div class="formGrid">
<div class="field">
            <label class="label">שם פרטי</label>
            <input class="input" name="firstName" required />
          </div>
<div class="field">
            <label class="label">שם משפחה</label>
            <input class="input" name="lastName" required />
          </div>
<div class="field">
            <label class="label">ת״ז</label>
            <input class="input" name="idNumber" inputmode="numeric" />
          </div>
<div class="field">
            <label class="label">תאריך לידה</label>
            <input class="input" name="birthDate" type="date" />
          </div>
<div class="field">
            <label class="label">מין</label>
            <select class="input" name="gender">
              <option value="">—</option>
              <option value="זכר">זכר</option>
              <option value="נקבה">נקבה</option>
            </select>
          </div>
<div class="field">
            <label class="label">מצב משפחתי</label>
            <select class="input" name="maritalStatus">
              <option value="">—</option>
              <option value="רווק/ה">רווק/ה</option>
              <option value="נשוי/אה">נשוי/אה</option>
              <option value="גרוש/ה">גרוש/ה</option>
              <option value="אלמן/ה">אלמן/ה</option>
              <option value="ידוע/ה בציבור">ידוע/ה בציבור</option>
            </select>
          </div>
<div class="field">
            <label class="label">ילדים</label>
            <input class="input" name="childrenCount" type="number" min="0" step="1" placeholder="0" />
          </div>
        </div>
      </section>
        <section class="lcStep" data-step="2" aria-label="יצירת קשר">
        <div class="formGrid">
<div class="field">
            <label class="label">טלפון</label>
            <input class="input" name="phone" inputmode="tel" required />
          </div>
<div class="field">
            <label class="label">מייל</label>
            <input class="input" name="email" type="email" inputmode="email" autocomplete="email" />
          </div>
<div class="field">
            <label class="label">כתובת</label>
            <input class="input" name="address" autocomplete="street-address" />
          </div>
<div class="field">
            <label class="label">מיקוד</label>
            <input class="input lcZipAuto" name="zipCode" inputmode="numeric" placeholder="יישלף אוטומטית מהכתובת (ניתן לערוך)" />
            <div class="help">המערכת מנסה לשלוף מיקוד לפי הכתובת. אם לא נמצא—אפשר להזין ידנית.</div>
          </div>
        </div>
      </section>
        <section class="lcStep" data-step="3" aria-label="פרופיל">
        <div class="formGrid">
<div class="field">
            <label class="label">עישון</label>
            <select class="input" name="smoker">
              <option value="">—</option>
              <option value="כן">כן</option>
              <option value="לא">לא</option>
            </select>
          </div>
<div class="field">
            <label class="label">עיסוק</label>
            <input class="input" name="occupation" placeholder="לדוגמה: נהג / מורה" />
          </div>
<div class="field">
            <label class="label">גובה (ס״מ)</label>
            <input class="input" name="heightCm" type="number" min="0" step="1" />
          </div>
<div class="field">
            <label class="label">משקל (ק״ג)</label>
            <input class="input" name="weightKg" type="number" min="0" step="1" />
          </div>
<div class="field">
            <label class="label">BMI</label>
            <input class="input lcBmiAuto" name="bmi" type="text" readonly placeholder="מחושב אוטומטית" />
            <div class="help">BMI מחושב לפי גובה/משקל (ק״ג/מ²).</div>
          </div>
<div class="field">
            <label class="label">קופת חולים</label>
            <select class="input" name="hmo">
              <option value="">—</option>
              <option value="כללית">כללית</option>
              <option value="מכבי">מכבי</option>
              <option value="מאוחדת">מאוחדת</option>
              <option value="לאומית">לאומית</option>
            </select>
          </div>
<div class="field">
            <label class="label">משלים שב״ן</label>
            <input class="input" name="supplemental" placeholder="זהב / כסף / פלטינום וכו׳" />
          </div>
<div class="field">
            <label class="label">תאריך הנפקת ת״ז</label>
            <input class="input" name="idIssueDate" type="date" />
          </div>
        </div>
      </section>
        <section class="lcStep" data-step="4" aria-label="פוליסות קיימות">
  <div class="crmSection crmSection--policies">
    <h3 class="crmSectionTitle">פוליסות קיימות</h3>
    <div class="crmSectionHint">מוסיפים את הפוליסות הקיימות של המבוטח. ניתן לבחור סטטוס ולציין נספחים בביטול חלקי.</div>

    <div class="formGrid">
      <div class="field">
        <label class="label">חברה</label>
        <select class="input" id="oldPolicyCompany">
          <option value="">— בחר חברה —</option>
          <option value="הכשרה">הכשרה</option>
          <option value="הפניקס">הפניקס</option>
          <option value="כלל">כלל</option>
          <option value="הראל">הראל</option>
          <option value="מגדל">מגדל</option>
          <option value="מנורה">מנורה</option>
          <option value="איילון">איילון</option>
          <option value="AIG">AIG</option>
          <option value="ביטוח ישיר">ביטוח ישיר</option>
          <option value="אחר">אחר</option>
        </select>
      </div>

      <div class="field">
        <label class="label">מוצר ביטוח</label>
        <select class="input" id="oldPolicyProduct">
          <option value="">— בחר מוצר —</option>
          <option value="בריאות">בריאות</option>
          <option value="מחלות קשות">מחלות קשות</option>
          <option value="מחלות סרטן">מחלות סרטן</option>
          <option value="תאונות אישיות">תאונות אישיות</option>
          <option value="ריסק">ריסק</option>
          <option value="ריסק משכנתא">ריסק משכנתא</option>
        </select>
      </div>

      <!-- Conditional fields by product -->
      <div class="field" id="oldPolicyInsuredSumWrap" style="display:none">
        <label class="label">סכום ביטוח בפוליסה</label>
        <input class="input" id="oldPolicyInsuredSum" type="number" min="0" step="1" placeholder="לדוגמה: 500000" />
      </div>

      <div class="field" id="oldPolicyCompSumWrap" style="display:none">
        <label class="label">סכום פיצוי</label>
        <input class="input" id="oldPolicyCompSum" type="number" min="0" step="1" placeholder="לדוגמה: 250000" />
      </div>

      <div class="field" id="oldPolicyLienWrap" style="display:none;grid-column:1/-1">
        <label class="label">שיעבוד</label>
        <div class="lcCheckRow">
          <label class="lcCheck">
            <input type="checkbox" id="oldPolicyHasLien" />
            <span>סימון שיעבוד (מוטב בלתי חוזר)</span>
          </label>
          <button class="btn btnSoft" type="button" id="oldPolicyLienBtn" style="display:none">פרטי המוטב הבלתי חוזר</button>
        </div>
        <div class="help" id="oldPolicyLienHint" style="display:none">פרטי השיעבוד נשמרו לפוליסה הזו.</div>
      </div>

<div class="field">
        <label class="label">מספר פוליסה</label>
        <input class="input" id="oldPolicyNumber" inputmode="numeric" placeholder="לדוגמה: 1234567" />
      </div>

      <div class="field">
        <label class="label">פרמיה חודשית</label>
        <input class="input" id="oldPolicyPremium" type="number" min="0" step="0.01" placeholder="לדוגמה: 120.50" />
      </div>

      <div class="field" style="grid-column:1/-1">
        <label class="label">סטטוס</label>
        <select class="input" id="oldPolicyStatus">
          <option value="">— בחר סטטוס —</option>
          <option value="ביטול מלא">ביטול מלא</option>
          <option value="ביטול חלקי">ביטול חלקי</option>
          <option value="נשאר ללא שינוי-לבקשת לקוח">נשאר ללא שינוי-לבקשת לקוח</option>
          <option value="מינוי סוכן">מינוי סוכן</option>
        </select>
      </div>

      <div class="lcRidersBox" id="oldPolicyRidersBox" style="display:none;grid-column:1/-1">
        <div class="lcRidersTop">
          <div class="lcRidersTitle">נספחים לביטול (ביטול חלקי)</div>
          <div class="lcRidersHint">הוסיפו נספחים אחד-אחד. בסיום לחצו "הוסף ביטוח".</div>
        </div>

        <div class="lcRidersRow">
          <input class="input" id="oldPolicyRiderInput" placeholder="שם נספח לביטול" />
          <button class="btn btnSoft" type="button" id="oldPolicyAddRiderBtn">הוסף נספח</button>
        </div>

        <div class="lcRidersList" id="oldPolicyRidersList"></div>
      </div>

      <div class="field" style="grid-column:1/-1;display:flex;gap:10px;justify-content:flex-end">
        <button class="btn btnPrimary" type="button" id="oldPolicyAddBtn">הוסף ביטוח</button>
      </div>
    </div>

    <div class="tableWrap policyTable">
      <div class="policyTableHead">
        <div class="policyTableTitle">פוליסות שנוספו</div>
        <div class="policyTableCount" id="oldPoliciesCount">0</div>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th>חברה</th>
            <th>מוצר</th>
            <th>מס׳ פוליסה</th>
            <th>פרמיה</th>
            <th>סטטוס</th>
            <th style="text-align:left">נספחים</th>
          </tr>
        </thead>
        <tbody id="oldPoliciesTbody">
          <tr><td colspan="6" style="opacity:.6">טרם נוספו פוליסות.</td></tr>
        </tbody>
      </table>
    </div>

    <div class="lcRidersViewer" id="oldPolicyRidersViewer" style="display:none">
      <div class="lcRidersViewer__head">
        <div class="lcRidersViewer__title" id="oldPolicyRidersViewerTitle">נספחים לביטול</div>
        <button class="iconBtn" type="button" id="oldPolicyRidersViewerClose" aria-label="סגור">✕</button>
      </div>
      <div class="lcRidersViewer__body" id="oldPolicyRidersViewerBody"></div>
    </div>

  </div>
</section>
      </div>

      <div class="lcStickyFooter">
        <div class="lcHint muted">מלא את הפרטים וסיים עם “שמירה”. אפשר לעבור שלבים עם “הבא/חזרה”.</div>
        <div class="lcFooterBtns">
          <button class="btn" type="button" id="custPrevBtn">חזרה</button>
          <button class="btn" type="button" id="custNextBtn">הבא</button>
          <span class="lcFooterSep"></span>
          <button class="btn" type="button" data-close="1">סגור</button>
          <button class="btn btn--primary" type="submit">שמירה</button>
        </div>
      </div>


      </form>
    </div>
  </div>


  
<!-- MODAL: Lien / Irrevocable Beneficiary -->
<div class="modal" id="modalLien" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="lienTitle">
    <div class="modal__head">
      <div>
        <div class="modal__kicker">פוליסה</div>
        <div class="modal__title" id="lienTitle">פרטי המוטב הבלתי חוזר</div>
      </div>
      <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
    </div>

    <form class="modal__body" id="lienForm">
      <div class="formGrid">
        <div class="field">
          <label class="label">שם בנק</label>
          <input class="input" id="lienBankName" placeholder="לדוגמה: בנק הפועלים" />
        </div>
        <div class="field">
          <label class="label">מספר בנק</label>
          <input class="input" id="lienBankNumber" inputmode="numeric" placeholder="לדוגמה: 12" />
        </div>

        <div class="field">
          <label class="label">מספר סניף</label>
          <input class="input" id="lienBranchNumber" inputmode="numeric" placeholder="לדוגמה: 123" />
        </div>
        <div class="field">
          <label class="label">סכום לשיעבוד</label>
          <input class="input" id="lienAmount" type="number" min="0" step="1" placeholder="לדוגמה: 350000" />
        </div>

        <div class="field">
          <label class="label">לכמה שנים</label>
          <input class="input" id="lienYears" type="number" min="0" step="1" placeholder="לדוגמה: 20" />
        </div>
        <div class="field" style="grid-column:1/-1">
          <label class="label">כתובת הבנק</label>
          <input class="input" id="lienAddress" placeholder="רחוב, מספר, עיר" />
        </div>
      </div>

      <div class="divider"></div>
      <div class="row row--between">
        <button class="btn" type="button" data-close="1">ביטול</button>
        <button class="btn btn--primary" type="submit">שמירה</button>
      </div>
    </form>
  </div>
</div>

<!-- CUSTOMER FILE: Full Screen -->
  <div class="customerFull" id="customerFull" aria-hidden="true">
    <div class="customerFull__backdrop" data-close="1"></div>

    <div class="customerFull__panel" role="dialog" aria-modal="true" aria-labelledby="cfName">
      <div class="customerFull__top">
        <div class="customerFull__title">
          <div class="customerFull__name" id="cfName">—</div>
</div>

        <div class="row" style="gap:10px">
          <button class="btn btn--primary" id="btnAddPolicy" type="button">הוספת ביטוח חדש</button>
          <button class="btn" id="btnEditCustomer" type="button">עדכון פרטי לקוח</button>
          <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
        </div>
      </div>

      <div class="customerFull__body">
        <div class="cfLayout">
          <aside class="cfSide">
            <div class="dashCard dashCard--solid">
              <div class="dashCard__k">פרמיה חודשית</div>
              <div class="dashCard__v" id="cfTotalPremium">₪0</div>
              <div class="dashCard__sub">מחושב מהביטוחים הפעילים</div>
            </div>

            <div class="dashCard dashCard--solid">
              <div class="dashCard__k">ביטוחים פעילים</div>
              <div class="dashCard__v" id="cfActiveCount">0</div>
              <div class="dashCard__sub">מתוך כלל הביטוחים</div>
            </div>



            <!-- SLA (My Flow) — scoped to Customer File -->
            <div class="dashCard dashCard--solid cfSlaCard" aria-label="תזמון לקוח">
              <div class="dashCard__k">תזמון לקוח</div>

              <div class="cfSlaRow" style="margin-top:8px">
                <select class="input" id="cfNextAction" aria-label="בחירת משימה"></select>
              </div>

              <div class="cfSlaRow cfSlaRowSplit" style="margin-top:8px">
                <input class="input" id="cfDueAt" type="date" aria-label="תאריך יעד" />
                <input class="input" id="cfDueTime" type="time" aria-label="שעת יעד" />
              </div>

              <div class="cfSlaMeta">
                <span class="cfSlaBadge" id="cfSlaBadge">—</span>
                <button class="btn btn--primary cfSlaSave" id="cfSlaSaveBtn" type="button">שמירת תזמון</button>
              </div>

              <div class="dashCard__sub">בחר משימה + תאריך ושעה (כרגע UI בלבד — שמירה/קפיצה נוסיף בשלב הבא)</div>
            </div>

            <!-- Customer documents (scoped to Customer File) -->
            <button class="dashCard dashCard--solid dashCard--action" id="cfDocsBtn" type="button" aria-label="מסמכי לקוח">
              <div class="dashCard__k">מסמכי לקוח</div>
              <div class="dashCard__v" aria-hidden="true">📁➕</div>
              <div class="dashCard__sub">העלאה/צפייה במסמכים</div>
            </button>

            <!-- Export customer to PDF (Print to PDF) -->
            <button class="dashCard dashCard--solid dashCard--action" id="cfPdfBtn" type="button" aria-label="הורדת PDF">
              <div class="dashCard__k">הורד PDF</div>
              <div class="dashCard__v" aria-hidden="true">⬇️📄</div>
              <div class="dashCard__sub">הורדת פרטי לקוח לקובץ PDF</div>
            </button>

            <div class="dashCard dashCard--solid">
              <div class="dashCard__k">נציג מטפל</div>
              <div style="margin-top:8px">
                <select class="input" id="cfAgentSelect" aria-label="נציג מטפל"></select>
              </div>
              <div class="dashCard__sub">שיוך לפי נציגים</div>
            </div>
          </aside>

          <main class="cfMain">
            <div class="customerHeaderWide">
  <!-- Premium customer details header (scoped to Customer File only) -->
  <div class="glassCard cfHeaderPremium" id="customerTopCard" aria-label="פרטי לקוח (Premium)">
    <div class="cfHeaderPremium__head">
      <div>
        <div class="cfHeaderPremium__title">פרטי לקוח</div>
        <div class="cfHeaderPremium__sub">מידע אישי ובריאותי (CRM)</div>
      </div>

      <!-- Quick chips: ID / Phone / Email -->
      <div class="cfHeaderPremium__chips" aria-label="פרטי קשר מהירים">
        <div class="cfChip">
          <span class="cfChip__icon" aria-hidden="true">🪪</span>
          <span class="cfChip__val" id="cfId">—</span>
        </div>
        <div class="cfChip cfChip--phone">
          <span class="cfChip__icon" aria-hidden="true">📞</span>
          <span class="cfChip__val" id="cfPhone">—</span>
          <button class="cfChip__action" id="cfCallBtn" type="button" aria-label="חיוג ללקוח" title="חיוג">📲</button>
        </div>
        <div class="cfChip cfChip--email">
          <span class="cfChip__icon" aria-hidden="true">✉️</span>
          <span class="cfChip__val" id="cfEmail">—</span>
          <button class="cfChip__action" id="cfMailBtn" type="button" aria-label="שליחת מייל ללקוח" title="שליחת מייל">📩</button>
        </div>
      </div>
    </div>

    <!-- Grouped cards -->
    <div class="cfGroups" aria-label="פרטי לקוח - קבוצות">
      <!-- Group 1: Identity & Contact -->
      <div class="cfGroupCard" aria-label="פרטי זיהוי ויצירת קשר">
        <div class="cfGroupCard__title">פרטי זיהוי ויצירת קשר</div>
        <div class="cfGroupRows">
          <div class="cfRow"><span class="cfRow__k">שם הלקוח</span><span class="cfRow__v" id="cfNameLine">—</span></div>
          <div class="cfRow"><span class="cfRow__k">כתובת</span><span class="cfRow__v" id="cfAddress">—</span></div>
        </div>
      </div>

      <!-- Group 2: Medical profile -->
      <div class="cfGroupCard" aria-label="פרופיל רפואי">
        <div class="cfGroupCard__title">פרופיל רפואי</div>
        <div class="cfGroupRows">
          <div class="cfRow"><span class="cfRow__k">תאריך לידה</span><span class="cfRow__v" id="cfBirthDate">—</span></div>
          <div class="cfRow"><span class="cfRow__k">מעשן</span><span class="cfRow__v" id="cfSmoker">—</span></div>
          <div class="cfRow cfRow--inline">
            <span class="cfRow__k">גובה / משקל / BMI</span>
            <span class="cfRow__v">
              <span class="cfInlineVal" id="cfHeight">—</span>
              <span class="cfInlineSep">•</span>
              <span class="cfInlineVal" id="cfWeight">—</span>
              <span class="cfInlineSep">•</span>
              <span class="cfInlineVal" id="cfBmi">—</span>
            </span>
          </div>
        </div>
      </div>

      <!-- Group 3: Additional info -->
      <div class="cfGroupCard" aria-label="מידע נוסף">
        <div class="cfGroupCard__title">מידע נוסף</div>
        <div class="cfGroupRows">
          <div class="cfRow"><span class="cfRow__k">קופת חולים</span><span class="cfRow__v" id="cfHmo">—</span></div>
          <div class="cfRow"><span class="cfRow__k">משלים שב״ן</span><span class="cfRow__v" id="cfSupplemental">—</span></div>
          <div class="cfRow"><span class="cfRow__k">תאריך הנפקת ת״ז</span><span class="cfRow__v" id="cfIdIssueDate">—</span></div>
          <div class="cfRow"><span class="cfRow__k">עיסוק</span><span class="cfRow__v" id="cfOccupation">—</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<section class="crmSection crmSection--policies" aria-label="הביטוחים שרכשתי בסוכנות">
  <div class="crmSection__row">
    <h2 class="crmSectionTitle">הביטוחים שרכשתי בסוכנות</h2>
    <div class="crmSectionHint">מתחת מופיעים הביטוחים שנרכשו עבור הלקוח</div>
  </div>
</section>

<div class="tableWrap policyTable">
          <table class="table">
            <thead>
              <tr>
                <th>סוג ביטוח</th>
                <th>חברה</th>
                <th>פרמיה חודשית</th>
                <th>תאריך חידוש</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="cfPoliciesTbody">
              <!-- injected -->
            </tbody>
          </table>
        </div>
</main>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Add Policy -->
  <div class="modal" id="modalPolicy" aria-hidden="true">
    <div class="modal__backdrop" data-close="1"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="policyTitle">
      <div class="modal__head">
        <div>
          <div class="modal__kicker">תיק לקוח</div>
          <div class="modal__title" id="policyTitle">הוספת ביטוח</div>
        </div>
        <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
      </div>

      <form class="modal__body" id="policyForm">
        <div class="formGrid">
          <div class="field">
            <label class="label">סוג ביטוח</label>
            <select class="input" name="type" required>
              <option value="">בחר</option>
              <option>בריאות</option>
              <option>מחלות קשות/סרטן</option>
              <option>ריסק</option>
              <option>ריסק משכנתא</option>
              <option>תאונות אישיות</option>
              <option>מדיקר</option>
              <option>דירה</option>
              <option>רכב</option>
            </select>
          </div>

          <div class="field">
            <label class="label">חברה</label>
            <select class="input" name="company" required>
              <option value="">בחר</option>
              <option>הפניקס</option>
              <option>מנורה</option>
              <option>איילון</option>
              <option>הראל</option>
              <option>כלל</option>
              <option>הכשרה</option>
            </select>
          </div>

          <div class="field">
            <label class="label">פרמיה חודשית</label>
            <input class="input" name="premium" inputmode="numeric" placeholder="לדוגמה 220" required />
          </div>

          <div class="field">
            <label class="label">תאריך חידוש</label>
            <input class="input" name="renewAt" type="date" />
          </div>
        </div>

        
      
        <div class="divider" style="margin-top:14px"></div>
        <div class="row row--between" style="gap:10px">
          <div class="muted">מלא את הפרטים ואז לחץ על "הוספת ביטוח"</div>
          <div class="row" style="gap:10px">
            <button class="btn" type="button" data-close="1">סגור</button>
            <button class="btn btn--primary" type="submit">הוספת ביטוח</button>
          </div>
        </div>

      </form>
    </div>
  </div>

  <!-- DRAWER: Customer File -->
  <div class="drawer" id="drawerCustomer" aria-hidden="true">
    <div class="drawer__backdrop" data-close="1"></div>
    <div class="drawer__panel" role="dialog" aria-modal="true" aria-labelledby="drawerTitle">
      <div class="drawer__head">
        <div>
          <div class="drawer__kicker">תיק לקוח</div>
          <div class="drawer__title" id="drawerTitle">—</div>
        </div>
        <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
      </div>

      <div class="drawer__body">
        <div class="profile">
          <div class="profile__card">
            <div class="profile__label">פרמיה חודשית</div>
            <div class="profile__value" id="drawerPremium">₪0</div>
            <div class="profile__sub">מעודכן ללקוח</div>
          </div>

          <div class="profile__details">
            <div class="detail">
              <div class="detail__k">שם מלא</div>
              <div class="detail__v" id="drawerName">—</div>
            </div>
            <div class="detail">
              <div class="detail__k">טלפון</div>
              <div class="detail__v" id="drawerPhone">—</div>
            </div>
            <div class="detail">
              <div class="detail__k">ת״ז</div>
              <div class="detail__v" id="drawerId">—</div>
            </div>
            <div class="detail">
              <div class="detail__k">הערות</div>
              <div class="detail__v" id="drawerNotes">—</div>
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="row row--between">
          <div class="muted">בהמשך נוסיף טאבים: מסמכים / משימות / היסטוריה / חתימות</div>
          <button class="btn" id="btnSaveCustomer" type="button">שמירה</button>
        </div>

      </div>
    </div>
  </div>

  
  <!-- CUSTOMER DOCS: Full Screen -->
  <div class="customerDocs" id="customerDocs" aria-hidden="true">
    <div class="customerDocs__backdrop" data-close="1"></div>

    <div class="customerDocs__panel" role="dialog" aria-modal="true" aria-labelledby="cdTitle">
      <div class="customerDocs__top">
        <div>
          <div class="customerDocs__kicker">מסמכי לקוח</div>
          <div class="customerDocs__title" id="cdTitle"><span id="cdName">—</span> • <span id="cdId">—</span></div>
          <div class="customerDocs__sub muted small">העלאה מקובץ / שמירת קישור (PDF/Drive) • נשמר בתיק לקוח ומסונכרן לשיטס</div>
        </div>

        <div class="row" style="gap:10px">
          <button class="btn" id="cdCloseBtn" type="button" data-close="1">סגור</button>
        </div>
      </div>

      <div class="customerDocs__body">
        <div class="cdLayout">
          <aside class="cdSide">
            <div class="glassCard cdCard">
              <div class="cdCard__title">הוספת מסמך</div>

              <div class="field">
                <label class="label">שם מסמך</label>
                <input class="input" id="cdDocName" type="text" placeholder="לדוגמה: תעודת זהות / הצעת מחיר / פוליסה" />
              </div>

              <div class="field">
                <label class="label">תאריך</label>
                <input class="input" id="cdDocDate" type="date" value="2026-02-07" />
              </div>

              <div class="divider" style="margin:14px 0"></div>

              <div class="cdTwo">
                <div class="cdTwo__col">
                  <div class="label">קישור (PDF / Drive)</div>
                  <input class="input" id="cdDocUrl" type="url" placeholder="הדבק קישור למסמך (Drive / PDF)" />
                  <button class="btn btn--primary" id="cdAddLinkBtn" type="button" style="margin-top:10px">שמירת קישור</button>
                  <div class="help">מומלץ למסמכים גדולים: העלה ל-Drive והדבק קישור.</div>
                </div>

                <div class="cdTwo__col">
                  <div class="label">קובץ מהמחשב</div>
                  <input class="input" id="cdFileInput" type="file" />
                  <button class="btn" id="cdUploadFileBtn" type="button" style="margin-top:10px">העלה ושמור</button>
                  <div class="help">אם הקובץ גדול, ייתכן שההעלאה תיחסם. במקרה כזה—העלה ל-Drive ושמור כקישור.</div>
                </div>
              </div>
            </div>
          </aside>

          <main class="cdMain">
            <div class="glassCard cdCard">
              <div class="cdCard__head">
                <div class="cdCard__title">מסמכים קיימים</div>
                <div class="muted small" id="cdCount">0 מסמכים</div>
              </div>

              <div class="tableWrap">
                <table class="table">
                  <thead>
                    <tr>
                      <th>שם</th>
                      <th style="width:150px">תאריך</th>
                      <th style="width:110px">סוג</th>
                      <th style="width:140px"></th>
                    </tr>
                  </thead>
                  <tbody id="cdTbody">
                    <!-- injected -->
                  </tbody>
                </table>
              </div>

              <div class="help">כדי לפתוח מסמך, לחץ “פתיחה”. כדי להסיר—“מחיקה”.</div>
            </div>
          </main>
        </div>
      </div>
    </div>
  </div>

<script src="./app.js"></script>

  <!-- MODAL: Policy Action (Cancel / Swap) -->
  <div class="modal" id="modalPolicyAction" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="policyActionTitle">
    <div class="modal__head">
      <div>
        <div class="modal__kicker">תיק לקוח</div>
        <div class="modal__title" id="policyActionTitle">—</div>
        <div class="help" id="policyActionSub" style="margin-top:6px">—</div>
      </div>
      <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
    </div>

    <div class="modal__body" style="padding:16px">
      <!-- CANCEL FLOW -->
      <div id="cancelFlow" style="display:none">
        <div class="card" style="margin-bottom:12px">
          <div class="card__head">
            <div class="card__title">בחירת פוליסה לביטול</div>
            <div class="card__hint">בחר פוליסה מתוך הרשימה</div>
          </div>
          <div style="padding:12px 14px">
            <div id="cancelPolicyList" class="policyPickList"><!-- injected --></div>
            <div class="divider" style="margin:12px 0"></div>

            <div class="row row--between" style="gap:10px; align-items:flex-start">
              <div>
                <div class="label">נבחר לביטול</div>
                <div class="badge" id="cancelSelectedSummary">לא נבחרה פוליסה</div>
              </div>
              <div style="min-width:240px; flex:1">
                <div class="field" style="gap:8px">
                  <label class="label" for="cancelReason">סיבת ביטול</label>
                  <textarea class="input" id="cancelReason" rows="3" placeholder="לדוגמה: יקר, כפילות, עבר לחברה אחרת..."></textarea>
                </div>
              </div>
            </div>

            <div class="divider" style="margin:12px 0"></div>

            <div class="formGrid" style="padding:0">
              <div class="field">
                <label class="label" for="cancelPostponeAt">דחיית טיפול (תאריך)</label>
                <input class="input" id="cancelPostponeAt" type="date" />
                <div class="help">אם תמלא תאריך – תיווצר “משימה” בפעילות הלקוח (בשלב הזה זה תיעוד בלבד).</div>
              </div>

              <div class="field">
                <label class="label" for="cancelTemplate">טופס ביטול לשליחה (בעתיד)</label>
                <select class="input" id="cancelTemplate">
                  <option value="">בחר טופס ביטול (לא נשלח עדיין)</option>
                  <option>ביטול פוליסת בריאות כלל</option>
                  <option>ביטול פוליסה בריאות הראל</option>
                  <option>ביטול פוליסה בריאות מנורה</option>
                  <option>ביטול פוליסה בריאות הפניקס</option>
                  <option>ביטול פוליסה בריאות מגדל</option>
                </select>
                <div class="help">בשלב הבא נחבר את זה לשליחה ללקוח לחתימה.</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- SWAP FLOW (placeholder for future) -->
      <div id="swapFlow" style="display:none">
        <div class="card">
          <div class="card__head">
            <div class="card__title">מסך שחלוף פוליסה</div>
            <div class="card__hint">בקרוב נוסיף כאן שדות ושחלוף מתקדם</div>
          </div>
          <div style="padding:14px">
            <div class="muted">המסך הזה הוכן במיוחד כדי שנוכל לבנות עליו בהמשך (ללא שינוי לוגיקת סנכרון).</div>
          </div>
        </div>
      </div>

    <div class="modal__foot" style="padding:0 16px 16px">
      <div class="row row--between" style="gap:10px">
        <button class="btn btn--danger" id="btnPolicyActionConfirm" type="button">אישור ביטול</button>
        <button class="btn" type="button" data-close="1">סגור</button>
      </div>
    </div>
    </div>

    
  </div>
</div>

      
    </div>
  </div>


<!-- USER EDIT MODAL (Admin only) -->
<div class="modal" id="modalUserEdit" aria-hidden="true">
  <div class="modal__backdrop" data-close="1"></div>
  <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="userEditTitle">
    <div class="modal__head">
      <div>
        <div class="modal__kicker">GEMEL INVEST</div>
        <div class="modal__title" id="userEditTitle">עריכת משתמש</div>
      </div>
      <button class="iconBtn" data-close="1" aria-label="סגור">✕</button>
    </div>

    <form class="modal__body" id="userEditForm">
      <input type="hidden" id="userEditKind" value="agent" />
      <input type="hidden" id="userEditId" value="" />

      <div class="field" data-only-agent>
        <label class="label" for="userEditName">שם נציג</label>
        <input class="input" id="userEditName" type="text" placeholder="לדוגמה: אוריה" />
      </div>

      <div class="field">
        <label class="label" for="userEditUsername">שם משתמש</label>
        <input class="input" id="userEditUsername" type="text" placeholder="שם משתמש להתחברות" autocomplete="off" />
      </div>

      <div class="field">
        <label class="label" for="userEditPin">סיסמה / קוד</label>
        <input class="input" id="userEditPin" type="password" placeholder="הקלד סיסמה" autocomplete="new-password" />
        <div class="help">טיפ: אפשר לבחור גם מספרים בלבד (PIN) אם זה יותר נוח לנציגים.</div>
      </div>

      <div class="field">
        <label class="label" style="display:flex; align-items:center; gap:10px">
          <input id="userEditActive" type="checkbox" checked />
          משתמש פעיל
        </label>
      </div>

      <div id="userEditError" class="lcUserEdit__error" aria-live="polite"></div>
    </form>

    <div class="modal__foot">
      <div class="row row--between" style="gap:10px">
        <button class="btn" type="button" data-close="1">ביטול</button>
        <button class="btn btn--primary" id="btnUserEditSave" type="button">שמירה</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
